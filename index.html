<!DOCTYPE html>
<html>
<head>
  <title>Balance Data</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    tr.border-bottom td {
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>Balance Data</h1>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Balance</th>
        <th>Capital</th>
        <th>API</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="balanceData">
    </tbody>
  </table>

  <script>
    const balanceData = document.getElementById('balanceData');

    function fetchAndRender(apiUrl, apiName) {
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          // Sort the data on the client-side by balance in descending order
          data.sort((a, b) => b.balance - a.balance);

          // Create an extra row for API name
          const apiRow = document.createElement('tr');
          const apiNameCell = document.createElement('td');
          apiNameCell.textContent = `API: ${apiName}`;
          apiNameCell.setAttribute('colspan', 5);
          apiRow.appendChild(apiNameCell);
          apiRow.classList.add('border-bottom'); // Add border to the bottom of the row
          balanceData.appendChild(apiRow);

          data.forEach((item, index) => {
            const row = document.createElement('tr');
            const nameCell = document.createElement('td');
            const balanceCell = document.createElement('td');
            const capitalCell = document.createElement('td');
            const apiCell = document.createElement('td');
            const actionCell = document.createElement('td');
            const getAccountDataBtn = document.createElement('button');

            nameCell.textContent = item.name;
            balanceCell.textContent = item.balance;
            capitalCell.textContent = item.capital;
            apiCell.textContent = apiName;

            getAccountDataBtn.textContent = 'Get Account Data';
            getAccountDataBtn.addEventListener('click', () => {
              fetchAccountData(apiName, item.id, balanceCell);
            });

            row.appendChild(nameCell);
            row.appendChild(balanceCell);
            row.appendChild(capitalCell);
            row.appendChild(apiCell);
            actionCell.appendChild(getAccountDataBtn);
            row.appendChild(actionCell);

            balanceData.appendChild(row);

            row.classList.add('border-bottom'); // Add border to the bottom of each row
          });
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    async function fetchAccountData(apiName, accountId, balanceCell) {
      try {
        const response = await fetch(`http://localhost:3000/${apiName}/account/${accountId}`);
        const data = await response.json();

        if (data.error) {
          alert(data.error); // Display error message if the account data is not available
        } else {
          alert(`Name: ${data.name}\nBalance: ${data.balance}\nCapital: ${data.capital}`); // Show the account data
          balanceCell.textContent = data.balance; // Update the balance in the table cell with the original value
        }
      } catch (error) {
        console.error('Error fetching account data:', error);
        alert('Error fetching account data'); // Display an error message if there's an issue with fetching the account data
      }
    }

    // Fetch and render data for both APIs
    fetchAndRender('http://localhost:3000/api1/balances', 'API1');
    fetchAndRender('http://localhost:3000/api2/balances', 'API2');
  </script>
</body>
</html>
